define(["jquery","core/ajax","block_totara_featured_links/visibility_form","core/str","core/config"],function(a,b,c,d,e){var f,g="",h={},i={ok:"",cancel:"",title:""},j=function(){var d=function(){this.baseurl=""};d.prototype=new totaraDialog_handler_treeview_multiselect,d.prototype.every_load=function(){a("#audience_visible_table").find("[cohortid]").each(function(){var b=a(this).attr("cohortid");j._toggle_items("item_"+b,!1)}),this._make_selectable(a(".treeview",this._container)),this._make_deletable(a(".selected",this._container))},g=h.instanceid;var j=new d;f=j;var k={};k[i.ok]=function(){j._update()},k[i.cancel]=function(){j._cancel()};var l=e.wwwroot+"/totara/cohort/dialog/";new totaraDialog("course-cohorts-visible-dialogue","add_audience_id",{buttons:k,title:i.title},l+"cohort.php?selected="+h.visibleselected+"&instancetype="+h.instancetype+"&instanceid="+h.instanceid+"&sesskey="+h.sesskey,j),d.prototype._update=function(){var d=a(".selected [id^=item]",this._container);d.each(function(){var d=a(this).attr("id").split("_");if(d=d[d.length-1],d=parseInt(d),!c.audience_list_contains(d)){var e=b.call([{methodname:"block_totara_featured_links_external_add_audience_list_item",args:{audienceid:d}}]);e[0].done(function(a){c.add_to_audience_list(a),c.add_to_audience_id(d),c.add_audience_table_listeners()})}}),j._dialog.hide()}};return{init:function(b,c,e){h.instancetype=b,h.instanceid=c,h.sesskey=e;var f=[];f.push({key:"ok",component:"moodle"}),f.push({key:"cancel",component:"moodle"}),f.push({key:"audience_add",component:"block_totara_featured_links"}),d.get_strings(f).done(function(b){i={ok:b[0],cancel:b[1],title:b[2]},window.dialogsInited?j():(a.isArray(window.dialoginits)||(window.dialoginits=[]),window.dialoginits.push(j))})}}});