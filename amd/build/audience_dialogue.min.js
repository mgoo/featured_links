define(["jquery","core/ajax","core/templates","block_featured_links/visibility_form","core/str","core/config"],function(a,b,c,d,e,f){var g,h="",i={},j={ok:"",cancel:"",title:""},k=function(){var c=function(){this.baseurl=""};c.prototype=new totaraDialog_handler_treeview_multiselect,c.prototype.every_load=function(){a("#audience_visible_table [cohortid]").each(function(){var b=a(this).attr("cohortid");e._toggle_items("item_"+b,!1)}),this._make_selectable(a(".treeview",this._container)),this._make_deletable(a(".selected",this._container))},h=i.instanceid;var e=new c;g=e;var k={};k[j.ok]=function(){e._update()},k[j.cancel]=function(){e._cancel()};var l=f.wwwroot+"/totara/cohort/dialog/";new totaraDialog("course-cohorts-visible-dialogue","add_audience_id",{buttons:k,title:j.title},l+"cohort.php?selected="+i.visibleselected+"&instancetype="+i.instancetype+"&instanceid="+i.instanceid+"&sesskey="+i.sesskey,e),c.prototype._update=function(){var c=a(".selected [id^=item]",this._container);c.each(function(){var c=a(this).attr("id").split("_");if(c=c[c.length-1],c=parseInt(c),!d.audience_list_contains(c)){var e=b.call([{methodname:"block_featured_links_external_add_audience_list_item",args:{cohortid:c}}]);e[0].done(function(a){d.add_to_audience_list(a),d.add_to_audience_id(c),d.add_audience_table_listeners()})}}),e._dialog.hide()}};return{init:function(b,c,d){i.instancetype=b,i.instanceid=c,i.sesskey=d;var f=[];f.push({key:"ok",component:"moodle"}),f.push({key:"cancel",component:"moodle"}),f.push({key:"audience_add",component:"block_featured_links"}),e.get_strings(f).done(function(b){j={ok:b[0],cancel:b[1],title:b[2]},window.dialogsInited?k():(a.isArray(window.dialoginits)||(window.dialoginits=[]),window.dialoginits.push(k))})}}});